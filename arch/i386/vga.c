#include <arch/i386/vga.h>
#include <arch/i386/io.h>

void vga_write_reg(unsigned char *regs)
{
    outb(*(regs++), VGA_MISC_WRITE); //misc

    for (char i = 0; i < 5; i++) { //sequencer
        outb(i, VGA_SEQ_INDEX);
        outb(*(regs++), VGA_SEQ_DATA);
        // *regs = inb(VGA_SEQ_DATA);
        // regs++;
    }

    //cathode ray tube controller
    // outb(0x03, VGA_CRTC_INDEX);
    // outb(inb(VGA_CRTC_DATA) | 0x80, VGA_CRTC_DATA);
    // outb(0x11, VGA_CRTC_INDEX);
    // outb(inb(VGA_CRTC_DATA) | ~0x80, VGA_CRTC_DATA);

    // regs[0x03] = regs[0x03] | 0x80;
    // regs[0x11] = regs[0x11] | ~0x80;

    for (char i = 0; i < 25; i++)
    {
        outb(i, VGA_CRTC_INDEX);
        outb(*(regs++), VGA_CRTC_DATA);
        // *regs = inb(VGA_CRTC_DATA);
        // regs++;
    }

    // for (char i = 0; i < 9; i++) { //graphics controller
    //     outb(i, VGA_GC_INDEX);
    //     outb(*(regs++), VGA_GC_DATA);
    //     // *regs = inb(VGA_GC_DATA);
    //     // regs++;
    // }

    // for (char i = 0; i < 21; i++) { //attribute controller
    //     inb(VGA_INSTAT_READ);
    //     outb(i, VGA_AC_INDEX);
    //     outb(*(regs++), VGA_AC_WRITE);
    //     // *regs = inb(VGA_AC_READ);
    //     // regs++;
    // }

    inl(VGA_INSTAT_READ);
    outb(0x20, VGA_AC_INDEX);
}

void vga_set_mode()
{
    unsigned char g_640x480x16[] =
    // {
    // /* MISC */
    //     0xE3,
    // /* SEQ */
    //     0x03, 0x01, 0x08, 0x00, 0x06,
    // /* CRTC */
    //     0x5F, 0x4F, 0x50, 0x82, 0x54, 0x80, 0x0B, 0x3E,
    //     0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    //     0xEA, 0x0C, 0xDF, 0x28, 0x00, 0xE7, 0x04, 0xE3,
    //     0xFF,
    // /* GC */
    //     0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x05, 0x0F,
    //     0xFF,
    // /* AC */
    //     0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x14, 0x07,
    //     0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F,
    //     0x01, 0x00, 0x0F, 0x00, 0x00
    // };
    {
/* MISC */
	0xE7,
/* SEQ */
	0x03, 0x01, 0x03, 0x00, 0x02,
/* CRTC */
	// 0x6B, 0x59, 0x5A, 0x82, 0x60, 0x8D, 0x0B, 0x3E,
	// 0x00, 0x47, 0x06, 0x07, 0x00, 0x00, 0x00, 0x00,
	// 0xEA, 0x0C, 0xDF, 0x2D, 0x08, 0xE8, 0x05, 0xA3,
	// 0xFF,
    0x6B, 0x59, 0x5A, 0x82, 0x60, 0x8D, 0x0B, 0x3E,
	0x00, 0x47, 0x06, 0x07, 0x00, 0x00, 0x00, 0x00,
	0xEA, 0x0C, 0xdf, 0x2D, 0x08, 0xe7, 0x04, 0xA3,
	0xFF,
/* GC */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x0E, 0x00,
	0xFF,
/* AC */
	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x14, 0x07,
	0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F,
	0x0C, 0x00, 0x0F, 0x08, 0x00,
};
    vga_write_reg(g_640x480x16);
}